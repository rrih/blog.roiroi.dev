{"pageProps":{"post":{"title":"cakephp-queue 事始め","date":"2021-06-13T12:47:07.322+09:00","slug":"cakephp-queue-quick-start","author":{"name":"ろい","picture":"https://github.com/rrih.png"},"content":"<p>CakePHP製のキューイング管理ライブラリ<br>\nこちらを試してみる<br>\n<a href=\"https://github.com/dereuromark/cakephp-queue\">https://github.com/dereuromark/cakephp-queue</a>  </p>\n<p>リポジトリは以下<br>\n<a href=\"https://github.com/rrih/quick-queue\">https://github.com/rrih/quick-queue</a></p>\n<p>とりあえず触ってみるという感じなので<a href=\"https://github.com/dereuromark/cakephp-queue/tree/master/docs\">document通り</a>にいじってみる</p>\n<p>プラグインインストール</p>\n<pre><code class=\"hljs language-bash\">$ composer require dereuromark/cakephp-queue</code></pre>\n<p>バージョン</p>\n<pre><code class=\"hljs language-php\"><span class=\"hljs-string\">\"php\"</span>: <span class=\"hljs-string\">\">=7.2\"</span>,\n<span class=\"hljs-string\">\"cakephp/cakephp\"</span>: <span class=\"hljs-string\">\"4.2.*\"</span>,\n<span class=\"hljs-string\">\"dereuromark/cakephp-queue\"</span>: <span class=\"hljs-string\">\"^5.4\"</span>,</code></pre>\n<p>src/Application.phpのbootstrap()内に設定記述</p>\n<pre><code class=\"hljs language-php\"><span class=\"hljs-keyword\">$this</span>->addPlugin(<span class=\"hljs-string\">'Queue'</span>);</code></pre>\n<p>キューイング用のテーブルを作成するコマンド実行</p>\n<pre><code class=\"hljs language-bash\">$ bin/cake migrations migrate -p Queue</code></pre>\n<p>こちらを実行すると、接続先のdbに<code>queue_phinxlog</code>、<code>queue_processes</code>、<code>queued_jobs</code>といったテーブルとそのレコードが生成されます。</p>\n<p>それぞれ中身をみてみると以下</p>\n<pre><code class=\"hljs language-bash\">mysql> select * from queue_processes;\nEmpty <span class=\"hljs-built_in\">set</span> (0.01 sec)\n\nmysql> select * from queued_jobs;\nEmpty <span class=\"hljs-built_in\">set</span> (0.01 sec)\n\nmysql> select * from queue_phinxlog;\n+----------------+------------------------------+---------------------+---------------------+------------+\n| version        | migration_name               | start_time          | end_time            | breakpoint |\n+----------------+------------------------------+---------------------+---------------------+------------+\n| 20150425180802 | Init                         | 2021-06-13 06:51:01 | 2021-06-13 06:51:01 |          0 |\n| 20150511062806 | Fixmissing                   | 2021-06-13 06:51:01 | 2021-06-13 06:51:01 |          0 |\n| 20150911132343 | ImprovementsForMysql         | 2021-06-13 06:51:01 | 2021-06-13 06:51:01 |          0 |\n| 20161319000000 | IncreaseDataSize             | 2021-06-13 06:51:01 | 2021-06-13 06:51:01 |          0 |\n| 20161319000001 | Priority                     | 2021-06-13 06:51:01 | 2021-06-13 06:51:01 |          0 |\n| 20161319000002 | Rename                       | 2021-06-13 06:51:01 | 2021-06-13 06:51:01 |          0 |\n| 20161319000003 | Processes                    | 2021-06-13 06:51:01 | 2021-06-13 06:51:01 |          0 |\n| 20171013131845 | AlterQueuedJobs              | 2021-06-13 06:51:01 | 2021-06-13 06:51:01 |          0 |\n| 20171013133145 | Utf8mb4Fix                   | 2021-06-13 06:51:01 | 2021-06-13 06:51:01 |          0 |\n| 20171019083500 | ColumnLength                 | 2021-06-13 06:51:01 | 2021-06-13 06:51:01 |          0 |\n| 20171019083501 | MigrationQueueNull           | 2021-06-13 06:51:01 | 2021-06-13 06:51:01 |          0 |\n| 20171019083502 | MigrationQueueStatus         | 2021-06-13 06:51:01 | 2021-06-13 06:51:01 |          0 |\n| 20171019083503 | MigrationQueueProcesses      | 2021-06-13 06:51:01 | 2021-06-13 06:51:01 |          0 |\n| 20171019083505 | MigrationQueueProcessesIndex | 2021-06-13 06:51:01 | 2021-06-13 06:51:01 |          0 |\n| 20171019083506 | MigrationQueueProcessesKey   | 2021-06-13 06:51:02 | 2021-06-13 06:51:02 |          0 |\n+----------------+------------------------------+---------------------+---------------------+------------+\n15 rows <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">set</span> (0.00 sec)</code></pre>\n","ogImage":{"url":"https://pbs.twimg.com/profile_banners/636879657/1606257712/1500x500"},"coverImage":"https://pbs.twimg.com/profile_banners/636879657/1606257712/1500x500"}},"__N_SSG":true}