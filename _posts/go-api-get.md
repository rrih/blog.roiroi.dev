---
title: '[Go] APIからJSONパース'
excerpt: ''
coverImage: 'https://pbs.twimg.com/profile_banners/636879657/1606257712/1500x500'
date: '2021-04-29T13:48:07.322+09:00'
author:
  name: ろい
  picture: 'https://github.com/rrih.png'
ogImage:
  url: 'https://pbs.twimg.com/profile_banners/636879657/1606257712/1500x500'
---

## 前提
Go なんもわからん初心者のメモ

Go で外部の WebAPI 叩いてごにょごにょやりたかった。それだけ



```json
{
  "user_id": 999,
  "nickname": "rrih",
  "name": "河原",
  "birthday": "1997-09-11",
  "gender": "male",
  "email": "example@rrih.co.jp",
  "phone_number": 1234567890
}
```

というjson形式のデータを返すapi(https://api.roiroi.dev/v1/example/users/me)があったとします。これを叩いてgoでごにょります。

ソース
```go
package main

import (
	"encoding/json"
	"fmt"
	"io"
	"net/http"
)

type AutoGenerated struct {
	UserID      int    `json:"user_id"`
	Nickname    string `json:"nickname"`
	Name        string `json:"name"`
	Birthday    string `json:"birthday"`
	Gender      string `json:"gender"`
	Email       string `json:"email"`
	PhoneNumber int    `json:"phone_number"`
}

func main() {
	url := "https://api.roiroi.dev/v1/example/users/me"
    resp, _ := http.Get(url)
    defer resp.Body.Close()
    // byteArray, _ := ioutil.ReadAll(resp.Body) ← 1.16系では非推奨
    byteArray, _ := io.ReadAll(resp.Body)

	jsonBytes := ([]byte)(byteArray)
	data := new(AutoGenerated)
	if err := json.Unmarshal(jsonBytes, data); err != nil {
		fmt.Println("JSON Unmarshal error:", err)
		return
	}

	fmt.Println(data.UserID)
	fmt.Println(data.Nickname)
	fmt.Println(data.Name)
	fmt.Println(data.Birthday)
	fmt.Println(data.Gender)
	fmt.Println(data.Email)
	fmt.Println(data.PhoneNumber)
}
```

json で受け取るデータの構造体を定義しておきます。  
`resp.Body` を `byteArray` にgoのバージョンは1.16なので `ioutil.ReadAll()` ではなく `io.ReadAll()` を使って`[]uint8`型のバイナリの配列として受け取る。これを第一引数、構造体をnewしたdataを第二引数として`json.Unmarshal()`関数に渡すと構造体にjson形式のデータが渡せたことになってる。(ように見えます)

あと[これ](https://mholt.github.io/json-to-go/)は便利。jsonから構造体を雑に定義したい時に使えます

## 参考文献
https://tikasan.hatenablog.com/entry/2017/04/26/110854